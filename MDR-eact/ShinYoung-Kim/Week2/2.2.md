# 가상 DOM과 리액트 파이버

## 1. DOM과 브라우저 렌더링 과정

`DOM` : 웹 페이지에 대한 인터페이스로 브라우저가 웹페이지의 콘텐츠와 구조를 어떻게 보여줄지에 대한 정보를 담고 있다.
<br/>

**브라우저가 렌더링 트리를 만드는 과정**

1. HTML 다운받고, 파싱하여 DOM 트리를 만든다.
2. CSS 파일을 다운받고, 파싱하여 CSSOM 트리를 만든다.
3. 사용자 눈에 보이는 DOM 노드만 순회하며 트리를 분석 및 CSS 적용

- 레이아웃: 스타일링 정보 계산
- 페인팅: 실제 유효한 모습 그리는 과정
- 레이아웃이 다시 일어나면, 반드시 페인팅이 다시 일어난다.

## 2. 가상 DOM의 탄생 배경

**가상 DOM을 사용하는 이유**
: 실제 DOM이 아닌 리액트에서 관리하는 가상의 DOM을 사용하여, DOM 계산을 브라우저가 아닌 메모리에서 진행한다.

- 불필요한 렌더링 과정이 최소화될 수 있다.
- 항상 빠른 것은 아니다.

## 3. 가상 DOM을 위한 아키텍처, 리액트 파이버

### 리액트 파이버란?

`리액트 파이버` : 리액트에서 관리하는 자바스크립트 객체로, 가상 DOM과 실제 DOM을 비교하여 변경사항이 있을 경우 화면에 렌더링을 요청한다.

- 렌더 단계에서는 비동기 작업을 수행하며 작업을 쪼개 우선순위 지정, 일시중지 및 폐기 등을 수행한다.
- 커밋 단계에서는 동기식으로 DOM에 실제 변경사항을 반영한다.

**리액트 파이버 생명주기**

- 리액트 파이버는 하나의 element당 한 개가 생성되며, 컴포넌트가 최초로 마운트되는 시점에 생성된다.
- 리액트 요소는 렌더링이 발생할 때마다 재생성되지만, 리액트 파이버는 최대한 재활용된다.
- state가 변경되거나 생명주기 메서드가 실행되거나 DOM 변경이 필요한 시점 등에 실행된다.
- 해당 작업은 리액트에서 유연하게 처리한다.

### 리액트 파이버 트리

파이버 트리는 현재 파이버 트리/작업 중인 상태 나타내는 파이버 트리로 두 개가 존재한다.

`더블 버퍼링` : 리액트 파이버의 작업이 끝나면 포인터만 변경하여 작업중인 파이버 트리(workInProgress)를 현재 트리로 바꾼다.

### 파이버의 작업 순서

1. 각 element `beginWork() -> 자식 탐색 -> completeWork() -> 형제 탐색`이 일어난다.
2. 모든 작업이 완료되고 루트 노드가 완성되면 `commitWork()`가 실행되고 변경사항 비교를 통해 DOM에 반영된다.
